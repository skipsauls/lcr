var window="undefined"==typeof window?{}:window;window.wave=function(){"use strict";function e(e){if(e&&e.apiVersion)try{var t=parseFloat(e.apiVersion.replace("v",""));if(t<parseFloat(P.replace("v","")))throw e.apiVersion=P,"Setting API version to "+P+", the minimum supported API version for Wave Analytics"}catch(n){console.error("Exception: ",n)}var a=localStorage.getItem("forceOAuth");if(a)try{force.oauth=JSON.parse(a),force.tokenStore.forceOAuth=a,s(function(e,t){t?(console.warn("initUser error; ",t),wave.logout()):V=e})}catch(n){force.oauth={},force.tokenStore.forceOAuth={}}force.init(e)}function t(e){var t=localStorage.getItem("forceOAuth"),n=!0;if(t)try{force.oauth=JSON.parse(t),force.tokenStore.forceOAuth=t,n=!1,"function"==typeof e&&s(function(t,n){n?console.warn("initUser error; ",n):(V=t,e({message:"Already authenticated"},null))})}catch(a){}n===!0&&force.login(function(t){localStorage.setItem("forceOAuth",force.tokenStore.forceOAuth),"function"==typeof e&&s(function(t,n){n?console.warn("initUser error; ",n):(V=t,e(t,null))})},function(t){"function"==typeof e&&e(null,t)})}function n(e){force.discardToken(),force.oauth={},force.tokenStore.forceOAuth={},localStorage.removeItem("forceOAuth"),"function"==typeof e&&e(null,null)}function a(){return force.isAuthenticated()}function o(e){return e}function i(e){if("string"==typeof e)return e;var t="object"==typeof e?e:JSON.parse(e),n=null;return n=t instanceof Array?t[0].message:t.message}function s(e){force.request({path:"/services/data/"+q+"/sobjects/User/"+force.getUserId()},function(t){"function"==typeof e&&e(t,null)},function(t){"function"==typeof e&&e(null,t)})}function r(e){V?e(V,null):s(e)}function u(e,t){var n={};for(var a in e)n[a]=e[a];for(var a in t)n[a]=t[a];return n}function f(e,t,n){console.warn("wave.createAsset: ",e,t);var a=u({method:"POST",path:"/services/data/"+q+"/wave/"+e,contentType:"application/json"},t);force.request(a,function(e){e=o(e),"function"==typeof n&&n(e,null)},function(e){e=i(e),"function"==typeof n&&n(null,e)})}function d(e,t){return void console.error("NOT SUPPORTED")}function l(e,t){e=e?e:{};var n=u(wave.Dashboard.template,e),a={data:n};f("dashboards",a,function(e,n){if(n)t(null,n);else{var a=new wave.Dashboard;a.init(e,function(){t(a,null)})}})}function c(e,t){return void console.error("NOT SUPPORTED")}function p(e,t){return void console.error("NOT SUPPORTED")}function h(e,t,n){console.warn("wave.removeAsset: ",e,t);var a=U[e],s=t.id||t[a+"Id"],r=u({method:"DELETE",path:"/services/data/"+q+"/wave/"+e+"/"+s},t);force.request(r,function(e){e=o(e),"function"==typeof n&&n(e,null)},function(e){e=i(e),"function"==typeof n&&n(null,e)})}function w(e,t){h("apps",e,t)}function v(e,t){h("dashboards",e,t)}function g(e,t){h("lenses",e,t)}function y(e,t){h("datasets",e,t)}function m(e,t,n){var a=u({method:"GET",path:"/services/data/"+q+"/wave/"+e},t);force.request(a,function(t){t=o(t[e]),"function"==typeof n&&n(t,null)},function(e){e=i(e),"function"==typeof n&&n(null,e)})}function _(){return{applicationStatus:"private",assetSharingUrl:"",createdBy:{id:force.getUserId(),name:V.Name,profilePhotoUrl:V.SmallPhotoUrl},icon:{id:force.getUserId(),name:"my-app.png",url:"/analytics/wave/web/proto/images/my-app.png"},id:force.getUserId(),label:"My Private App",name:"My_Private_App",permissions:{manage:!0,modify:!0,view:!0},shares:[],type:"folder",url:"/services/data/v36.0/wave/folders/"+force.getUserId()}}function b(e,t){m("folders",e,function(e,n){var a=[],o=null,i=_();o=new wave.App,o.init(i),a.push(o);for(var s=e,r=0;r<s.length;r++)o=new wave.App,o.init(s[r]),a.push(o);t(a,n)})}function A(e,t){m("dashboards",e,function(e,n){for(var a=[],o=null,i=e,s=0;s<i.length;s++)o=new wave.Dashboard,o.init(i[s]),a.push(o);t(a,n)})}function D(e,t){m("lenses",e,function(e,n){for(var a=[],o=null,i=e,s=0;s<i.length;s++)o=new wave.Lens,o.init(i[s]),a.push(o);t(a,n)})}function T(e,t){m("datasets",e,function(e,n){for(var a=[],o=null,i=e,s=0;s<i.length;s++)o=new wave.Dashboard,o.init(i[s]),a.push(o);t(a,n)})}function S(e,t,n){var a=U[e],s=t.id||t[a+"Id"],r=u({method:"GET",path:"/services/data/"+q+"/wave/"+e+"/"+s},t);force.request(r,function(e){e=o(e),"function"==typeof n&&n(e,null)},function(e){e=i(e),"function"==typeof n&&n(null,e)})}function I(e,t){if(e.id===force.getUserId()){var n=_();if("function"==typeof t){var a=new wave.App;a.init(n,function(){t(a,null)})}}else S("folders",e,function(e,n){if("function"==typeof t)if(n)t(e,n);else{var a=new wave.App;a.init(e,function(){t(a,null)})}})}function B(e,t){S("dashboards",e,function(e,n){if("function"==typeof t)if(n)t(e,n);else{var a=new wave.Dashboard;a.init(e,function(){t(a,null)})}})}function M(e,t){S("lenses",e,function(e,n){if("function"==typeof t)if(n)t(e,n);else{var a=new wave.Lens;a.init(e,function(){t(a,null)})}})}function O(e,t){S("datasets",e,function(e,n){if("function"==typeof t)if(n)t(e,n);else{var a=new wave.Dataset;a.init(e,function(){t(a,null)})}})}function z(e,t,n){console.warn("updateAsset: ",e,t,n);var a=e.url,s={method:"PATCH",path:e.url,contentType:"application/json"};console.warn("url: ",a),console.warn("opts: ",s);var r={};if(t instanceof Array)for(var u=0;u<t.length;u++)r[t[u]]=e[t[u]];else r[t]=e[t];console.warn("data: ",r),s.data=r,console.warn("opts: ",s),force.request(s,function(e){e=o(e),"function"==typeof n&&n(e,null)},function(e){e=i(e),"function"==typeof n&&n(null,e)})}function L(e,t){var n=[];if(e.files&&e.files.length>0)for(var a=0,o=0;o<e.files.length;o++)!function(o){if("assetPreviewThumb"===o.fileName&&"image/png"===o.contentType){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(i.status>199&&i.status<300){var o=new Blob([i.response],{type:"image/png"}),s=new FileReader;s.id=e.id,s.onload=function(o){var i=o.target.result,s=i.replace(/^[^,]+,/,"");n.push("data:image/png;base64,"+s),a++,a>=e.files.length&&t instanceof Function&&t(n)},s.readAsDataURL(o)}else console.error(i.responseText)},i.open("GET",force.oauth.instance_url+o.url,!0),i.responseType="arraybuffer",i.setRequestHeader("Authorization","Bearer "+force.oauth.access_token),i.send(void 0)}}(e.files[o]);else e.icon?(n.push(force.oauth.instance_url+e.icon.url),t(n)):t instanceof Function&&t(null)}var q="v37.0",P="v36.0",V=null,U={dashboards:"dashboard",datasets:"dataset",lenses:"lens"};return{init:e,login:t,logout:n,isAuthenticated:a,getUser:r,createAsset:f,createApp:d,createDashboard:l,createLens:c,createDataset:p,removeAsset:h,removeApp:w,removeDashboard:v,removeLens:g,removeDataset:y,getAssets:m,getAsset:S,updateAsset:z,getImages:L,getApps:b,getApp:I,getDashboards:A,getDashboard:B,getLenses:D,getLens:M,getDatasets:T,getDataset:O}}(),window.wave.Base=function(){},window.wave.Base.prototype._def={},window.wave.Base.prototype.defaultImage="/analytics/wave/web/proto/images/thumbs/thumb-dashboard.png",window.wave.Base.prototype.init=function(e,t){this._def=e,this._typeMap={folder:"app"},this.template={},this.getDef=function(e){return"function"!=typeof e?this._def:void e(this._def,null)},this.getId=function(){return this._def.id},this.getApp=function(e){this._def&&this._def.folder?getApp({id:this._def.folder.id},e):"function"==typeof e&&e(null,"No app found, perhaps you are calling this from an App?")},"function"==typeof t&&t(this)},window.wave.Base.prototype.getType=function(){return this._typeMap[this._def.type]||this._def.type},window.wave.Base.prototype.getName=function(){return this._def.name},window.wave.Base.prototype.getLabel=function(){return this._def.label},window.wave.Base.prototype.setLabel=function(e){this._def.label=e,wave.updateAsset(this._def,"label",function(e,t){console.warn("updateAsset returned: ",e,t)})},window.wave.Base.prototype.getFolderId=function(){return this._def.folder.id},window.wave.Base.prototype.setFolderId=function(e){this._def.folder.id=e,wave.updateAsset(this._def,"folder",function(e,t){console.warn("updateAsset returned: ",e,t)})},window.wave.Base.prototype.getPreview=function(e){if(this._def.imageData)"function"==typeof e&&e(this._def.imageData.length?this._def.imageData[0]:this._def.imageData,null);else{var t=this,n=window.performance.now();wave.getImages(this._def,function(a){var o=window.performance.now();if(console.log("getImages timing: "+(null!==a?a.length:0)+" images in "+((o-n)/1e3).toFixed(4)+" seconds"),t._def.imageData=a,"function"==typeof e){t._def.imageData?(t._def.imageData.length?t._def.imageData[0]:t._def.imageData,force.oauth.instance_url+t.defaultImage):null;e(t._def.imageData||force.oauth.instance_url+t.defaultImage)}})}},window.wave.Dataset=function(){window.wave.Base.call(),this.getVersions=function(e){var t={method:"GET",path:this._def.versionsUrl},n=this;force.request(t,function(t){t=processResponse(t),n._def.versions=t.versions,"function"==typeof e&&e(t.versions,null)},function(t){t=processError(t),"function"==typeof e&&e(null,t)})},this.getVersion=function(e,t){for(var n=null,a=0;a<this._def.versions.length;a++)if(this._def.versions[a].id===e){n=this._def.versions[a];break}if(this._def.versions[a].data)return void t(this._def.versions[a].data,null);var o={method:"GET",path:n.url},i=this;force.request(o,function(e){e=processResponse(e),i._def.versions[a].data=e,"function"==typeof t&&t(e,null)},function(e){e=processError(e),"function"==typeof t&&t(null,e)})},this.getDimensions=function(e){if(this._def.versions){var t=null;this.getVersion(this._def.versions[0].id,function(n,a){t=n,t.xmdMain?e(t.xmdMain.dimensions,null):e(null,"No dimensions found")})}},this.getMeasures=function(e){if(this._def.versions){var t=null;this.getVersion(this._def.versions[0].id,function(n,a){t=n,t.xmdMain?e(t.xmdMain.measures,null):e(null,"No measures found")})}},this.getDates=function(e){if(this._def.versions){var t=null;this.getVersion(this._def.versions[0].id,function(n,a){t=n,t.xmdMain?e(t.xmdMain.dates,null):e(null,"No dates found")})}}},window.wave.Dataset.prototype=Object.create(window.wave.Base.prototype),window.wave.Dataset.prototype.constructor=window.wave.Dataset,window.wave.Dataset.prototype.defaultImage="/analytics/wave/web/proto/images/thumbs/thumb-edgemart.png",window.wave.Lens=function(){wave.Base.call();var e={calheatmap:"Calendar heat map",comparisontable:"Comparison table",heatmap:"Heat map",hbar:"Horizontal bar",hbarhdot:"Horizontal dot plot",matrix:"Matrix",parallelcoords:"Parallel coordinates",pie:"Donut",pivottable:"Pivot table",scatter:"Scatter plot",stackhbar:"Stacked horizontal bar",stackvbar:"Stacked vertical bar",time:"Time line",valuestable:"Values table",vbar:"Vertical bar",vdot:"Vertical dot plot"};this.getVisualizationTypes=function(){return e},this.getVisualizationType=function(){return this._def?{name:this._def.visualizationType,label:e[this._def.visualizationType]}:null}},window.wave.Lens.prototype=Object.create(window.wave.Base.prototype),window.wave.Lens.prototype.constructor=window.wave.Lens,window.wave.Lens.prototype.defaultImage="/analytics/wave/web/proto/images/thumbs/thumb-chart-hbar.png",window.wave.Lens.prototype.setVisualizationType=function(e){this._def.visualizationType=e,updateAsset(this._def,"visualizationType",function(e,t){console.warn("updateAsset returned: ",e,t)})},window.wave.Widget=function(){this.callbacks={};var e=this;this.listener=function(t){try{var n=t.data.data,a=n.uid,o=e.callbacks[a];"function"==typeof o&&(n.err?o(null,n.err):o(n.result,null))}catch(i){}},this.init=function(e,t){this._name=e,this._def=t,window.addEventListener("message",this.listener,!1)},this.sendMessage=function(e,t){var n=Date.now();this.callbacks[n]=t,e.uid=n;var a=document.getElementsByClassName("wave-embedded-frame")[0],o=a.contentWindow;o.postMessage(e,"*")},this.getView=function(){var e=document.getElementsByClassName("wave-embedded-frame")[0],t=e.contentDocument.getElementById("explore"),n=t.contentWindow.edgeChrome.tabManager.getSelectedView();return n},this.getReactComponent=function(){var e=this.getView(),t=e.getReactComponent();return t},this.getName=function(){return this._name},this.getChartType=function(){return this._def.parameters.visualizationType},this.getChartTypes=function(e){var t={type:"function_call",name:"getChartTypes",params:{name:this._name}};this.sendMessage(t,e)},this.setChartType=function(e){this._def.parameters.visualizationType=e;var t={type:"function_call",name:"setChartType",params:{name:this._name,type:this._def.parameters.visualizationType}};this.sendMessage(t)}},window.wave.Dashboard=function(){window.wave.Base.call(),this.previewUrl="https://wavepm.force.com/demo/embed2?id={{id}}",this.createComponent=function(e,t){console.warn("Dashboard.creatComponent config: ",e);var n=null;e.locator&&e.locator.id&&(n=document.getElementById(e.locator.id));var a=e.width||"600px",o=e.height||"500px",i=e.style||"",s="wave-embedded-frame"+(e["class"]?" "+e["class"]:""),r=Date.now(),u=e.name||"embed_"+r,f=e.id||"embed_"+r;if(n){var d=document.createElement("iframe");d.setAttribute("width",a),d.setAttribute("height",o),d.setAttribute("name",u),d.setAttribute("id",f),d.setAttribute("class",s),d.setAttribute("style",i),d.src=this.previewUrl.replace("{{id}}",this.getId()),d.onload=function(e){console.warn("iframe onload: ",e),"function"==typeof t&&t(e,null)},d.onerror=function(e){console.error("iframe error: ",e),"function"==typeof t&&t(null,e)},n.appendChild(d)}},this.getWidgets=function(e){var t={},n=null;for(var a in this._def.state.widgets)n=new wave.Widget,n.init(a,this._def.state.widgets[a]),t[a]=n;return"function"==typeof e&&e(t,null),t},this.getWidget=function(e,t){var n=new wave.Widget;return n.init(e,this._def.state.widgets[e]),"function"==typeof t&&t(n,null),n},this.getChartType=function(e,t){var n=this.getWidgets(),a=n[e],o=a.getChartType();return"function"==typeof t&&t(o,null),o},this.setChartType=function(e,t,n){var a=this.getWidgets(),o=a[e],i=(o.setChartType(t),{}),s=null;for(var r in this._def.state.steps){i[r]=this._def.state.steps[r],s=i[r].query.query.replace(/\&quot;/g,'"'),console.warn("query: ",s),i[r].query.query=s;for(var u=0;u<i[r].datasets.length;u++)i[r].datasets[u]={name:i[r].datasets[u].name}}var f={url:this._def.url,label:this._def.label,folder:{id:this._def.folder.id},state:{steps:i,widgets:this._def.state.widgets,layouts:this._def.state.layouts,gridLayouts:this._def.state.gridLayouts}};wave.updateAsset(f,["label","folder","state"],function(e,a){console.warn("updateAsset returned: ",e,a),"function"==typeof n&&n(t,null)})},this.store=function(e){var t={url:this._def.url,label:this._def.label,folder:{id:this._def.folder.id},state:{steps:this._def.state.steps,widgets:this._def.state.widgets,layouts:this._def.state.layouts,gridLayouts:this._def.state.gridLayouts}};wave.updateAsset(t,["label","folder","state"],function(t,n){console.warn("updateAsset returned: ",t,n),"function"==typeof e&&(n?e(null,n):e(t,null))})},this.addStep=function(e,t,n){console.warn("Dashboard.addStep: ",t);var a=this._def.state.steps,o=0;for(var i in a)o++;var s=t;console.warn("stepDef: ",s),a[e]=s,console.warn("steps")},this.addWidget=function(e,t,n,a,o,i){console.warn("Dashboard.addWidget: ",t,n,a);var s=this._def.state.widgets,r={parameters:n,position:a,type:t};console.warn("widgetDef: ",r);var u=0;for(var f in s)s[f].type===t&&u++;s[e]=r,console.warn("widgets: ",s);var d=this._def.state.gridLayouts,l=d[0],c=l.pages[0];c.widgets.push(o),console.warn("myDashboard: ",myDashboard)}},window.wave.Dashboard.prototype=Object.create(window.wave.Base.prototype),window.wave.Dashboard.prototype.constructor=window.wave.Dashboard,window.wave.Dashboard.prototype.defaultImage="/analytics/wave/web/proto/images/thumbs/thumb-dashboard.png",window.wave.Dashboard.template={folder:{id:"005B0000001ow8xIAA"},label:"New Dashboard",name:"New_Dashboard",description:"",state:{gridLayouts:[{name:"desktop",pages:[{widgets:[]}],selectors:[],version:1,widgetStyle:{borderEdges:[]}}],layouts:[],steps:{},widgets:{}}},window.wave.Step=function(){this.getDef=function(e){return this._def},this.setName=function(e){this.name=e},this.getName=function(){return this.name},this.setDatasets=function(e){this._def.datasets=e},this.getDatasets=function(){return this._def.datasets},this.addDataset=function(e,t){this._def.datasets.push(e)},this.setFacet=function(e){this._def.isFacet=e},this.isFacet=function(){return this._def.isFacet},this.setIsGlobal=function(e){this._def.isGlobal=e},this.isGlobal=function(){return this._def.isGlobal},this.setQuery=function(e){this._def.query.query=e},this.getQuery=function(){return this._def.query.query},this.setQueryVersion=function(e){this._def.query.version=e},this.getQueryVersion=function(){return this._def.query.version},this.setSelectMode=function(e){this._def.selectMode=e},this.getSelectMode=function(){return this._def.selectMode},this.setType=function(e){this._def.type=e},this.getType=function(){return this._def.type},this.setSelectMode=function(e){this._def.selectMode=e},this.getSelectMode=function(){return this._def.selectMode},this.setUseGlobal=function(e){this._def.useGlobal=e},this.useGlobal=function(){return this._def.isGlobal},this.setVisualizationType=function(e){this._def.visualizationParameters.visualizationType=e},this.getVisualizationType=function(){return this._def.visualizationParameters.visualizationType},this.setVisualizationOptions=function(e){this._def.visualizationParameters.options=e},this.getVisualizationOptions=function(){return this._def.visualizationParameters.options}},window.wave.Step.prototype=Object.create(Object),window.wave.Step.prototype.constructor=window.wave.Step,window.wave.Step.prototype.name=null,window.wave.Step.prototype._def={datasets:[],isFacet:!0,isGlobal:!1,query:{query:null,version:-1},selectMode:"single",type:"aggregate",useGloba:!0,visualizationParameters:{visualizationType:"hbar"}},window.wave.App=function(){window.wave.Base.call(),this.getDashboards=function(e){getDashboards({params:{folderId:this._def.id}},e)},this.getLenses=function(e){getLenses({params:{folderId:this._def.id}},e)},this.getDatasets=function(e){getDatasets({params:{folderId:this._def.id}},e)}},window.wave.App.prototype=Object.create(window.wave.Base.prototype),window.wave.App.prototype.constructor=window.wave.App,window.wave.App.prototype.defaultImage="/analytics/wave/web/proto/images/app/icons/16.png";